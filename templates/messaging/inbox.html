{% extends 'base.html' %}

{% block title %}Messagerie - Amazon Audit{% endblock %}

{% block content %}
<div class="messaging-page">
    <header class="page-header">
        <div class="header-content">
            <h1>üì¨ Messagerie</h1>
            <p>Vos √©changes avec notre √©quipe</p>
        </div>
        <a href="{% url 'messaging:new_conversation' %}" class="btn btn-primary">
            ‚úâÔ∏è Nouveau message
        </a>
    </header>
    
    <div class="conversations-list">
        {% if conversations %}
            {% for conversation in conversations %}
            <a href="{% url 'messaging:conversation' conversation.id %}" class="conversation-card {% if conversation.unread_count > 0 %}has-unread{% endif %}">
                <div class="conversation-icon">
                    {% if conversation.status == 'open' %}
                        <span class="status-indicator open"></span>
                    {% elif conversation.status == 'awaiting_reply' %}
                        <span class="status-indicator awaiting"></span>
                    {% elif conversation.status == 'resolved' %}
                        <span class="status-indicator resolved"></span>
                    {% else %}
                        <span class="status-indicator closed"></span>
                    {% endif %}
                </div>
                <div class="conversation-content">
                    <div class="conversation-header">
                        <h3>{{ conversation.subject }}</h3>
                        {% if conversation.unread_count > 0 %}
                        <span class="unread-badge">{{ conversation.unread_count }}</span>
                        {% endif %}
                    </div>
                    <div class="conversation-meta">
                        <span class="category">{{ conversation.get_category_display }}</span>
                        <span class="separator">‚Ä¢</span>
                        <span class="status">{{ conversation.get_status_display }}</span>
                        <span class="separator">‚Ä¢</span>
                        <span class="date">{{ conversation.updated_at|date:"d/m/Y H:i" }}</span>
                    </div>
                </div>
                <div class="conversation-arrow">‚Üí</div>
            </a>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üí¨</div>
                <h3>Aucune conversation</h3>
                <p>Vous n'avez pas encore de conversation avec notre √©quipe.</p>
                <a href="{% url 'messaging:new_conversation' %}" class="btn btn-primary">
                    D√©marrer une conversation
                </a>
            </div>
        {% endif %}
    </div>
</div>

<style>
.messaging-page {
    max-width: 800px;
    margin: 0 auto;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-8);
}

.header-content h1 {
    margin-bottom: var(--spacing-1);
}

.header-content p {
    color: var(--color-gray-600);
    margin: 0;
}

.conversations-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-3);
}

.conversation-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-4);
    background: var(--color-white);
    padding: var(--spacing-5);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
}

.conversation-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateX(4px);
}

.conversation-card.has-unread {
    border-left: 4px solid var(--color-primary);
    background: linear-gradient(to right, rgba(255, 152, 0, 0.05), transparent);
}

.conversation-icon {
    flex-shrink: 0;
}

.status-indicator {
    display: block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.status-indicator.open { background: #22C55E; }
.status-indicator.awaiting { background: #F59E0B; }
.status-indicator.resolved { background: #3B82F6; }
.status-indicator.closed { background: #9CA3AF; }

.conversation-content {
    flex: 1;
    min-width: 0;
}

.conversation-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.conversation-header h3 {
    font-size: var(--font-size-base);
    font-weight: 600;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.unread-badge {
    background: var(--color-primary);
    color: white;
    font-size: var(--font-size-xs);
    font-weight: 700;
    padding: 2px 8px;
    border-radius: var(--radius-full);
}

.conversation-meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    margin-top: var(--spacing-1);
    font-size: var(--font-size-sm);
    color: var(--color-gray-500);
}

.separator {
    color: var(--color-gray-300);
}

.conversation-arrow {
    flex-shrink: 0;
    color: var(--color-gray-400);
    font-size: var(--font-size-lg);
}

.empty-state {
    text-align: center;
    padding: var(--spacing-12);
    background: var(--color-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: var(--spacing-4);
}

.empty-state h3 {
    margin-bottom: var(--spacing-2);
}

.empty-state p {
    color: var(--color-gray-600);
    margin-bottom: var(--spacing-6);
}
</style>
{% endblock %}
